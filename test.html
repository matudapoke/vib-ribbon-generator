<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>カレンダー登録リンク生成</title>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
        input, textarea { width: 100%; margin-bottom: 10px; padding: 8px; box-sizing: border-box; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>

    <h2>予定をカレンダーに追加</h2>
    
    <label>イベント名</label>
    <input type="text" id="summary" value="打ち合わせ">

    <label>開始日時</label>
    <input type="datetime-local" id="dtstart">

    <label>終了日時</label>
    <input type="datetime-local" id="dtend">

    <label>場所</label>
    <input type="text" id="location" value="オンライン">

    <label>詳細内容</label>
    <textarea id="description">プロジェクトの進捗確認を行います。</textarea>

    <button onclick="generateIcs()">カレンダーに追加する（.ics生成）</button>

    <script>
        // 今日の日付を初期値に設定
        const now = new Date();
        now.setMinutes(0);
        document.getElementById('dtstart').value = now.toISOString().slice(0, 16);
        now.setHours(now.getHours() + 1);
        document.getElementById('dtend').value = now.toISOString().slice(0, 16);

        function generateIcs() {
            const summary = document.getElementById('summary').value;
            const location = document.getElementById('location').value;
            const description = document.getElementById('description').value;
            
            // 日付のフォーマット変換 (YYYY-MM-DDTHH:mm -> YYYYMMDDTHHmmSS)
            const formatDate = (dateStr) => {
                return dateStr.replace(/[-:]/g, '') + '00';
            };

            const start = formatDate(document.getElementById('dtstart').value);
            const end = formatDate(document.getElementById('dtend').value);

            // 1. iCalendar形式のテキストを作成
            // ※本来はUTC(Z)にするのが望ましいですが、簡易的にローカル時間で作成します
            const icsData = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//My App//JS-Gen//JA',
                'BEGIN:VEVENT',
                `SUMMARY:${summary}`,
                `DTSTART:${start}`,
                `DTEND:${end}`,
                `LOCATION:${location}`,
                `DESCRIPTION:${description}`,
                'END:VEVENT',
                'END:VCALENDAR'
            ].join('\r\n');

            // 2. Blob（バイナリデータ）を作成
            const blob = new Blob([icsData], { type: 'text/calendar;charset=utf-8' });

            // 3. ダウンロード用のリンクを一時的に作ってクリックさせる
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'event.ics';
            link.click();

            // 4. メモリ解放
            URL.revokeObjectURL(link.href);
        }
    </script>
</body>
</html>